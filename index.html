<!DOCTYPE html>
<html lang="es-AR">
  <head>
    <meta name="theme-color" content="#336587" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script type="module" src="/components/trip-entry-slim.js"></script>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ›©</text></svg>"
    />
    <title>ðŸª¹ðŸ¦µ FeelingAir</title>

    <style>
      /* Reset */
      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        height: 100%;
        min-height: 100%;
        font-size: 100%;
        line-height: 1.25;
        scroll-behavior: smooth;
        color: currentColor;
      }

      /* Global styles */

      @font-face {
        font-family: "Objective";
        src: url("/assets/fonts/Objective-Regular.woff2") format("woff2");
        font-weight: 400;
        font-style: normal;
        font-display: swap;
      }

      :root {
        --base-dark: #222222;
        --base-light: #f5f5f5;
        --brand-color: hsl(205, 45%, 43%);
        --brand-color-light: color-mix(
          in srgb,
          var(--brand-color) 40%,
          var(--base-light)
        );
        --brand-color-dark: color-mix(
          in srgb,
          var(--brand-color) 40%,
          var(--base-dark)
        );

        --main-color: var(--base-dark);
        --bg-color: var(--base-light);
        --mix-color: var(--brand-color-dark);

        --accent-color: color-mix(in srgb, var(--mix-color) 90%, transparent);
        --hover-bg-color: color-mix(
          in srgb,
          var(--mix-color) 15%,
          var(--bg-color)
        );

        @media (prefers-color-scheme: dark) {
          --main-color: var(--base-light);
          --bg-color: var(--brand-color);
          --mix-color: var(--brand-color-light);
        }
      }

      body {
        font-family: Objective, system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans",
          "Helvetica Neue", sans-serif;
        background-color: var(--bg-color);
        color: var(--main-color);
        accent-color: var(--accent-color);
      }
    </style>
  </head>
  <body>
    <header>
      <img src="/assets/images/feelingair.svg" alt="FeelingAir" />
    </header>
    <main>
      <section id="trips">
        <p style="text-align: center">...</p>
      </section>
    </main>

    <style>
      header {
        text-align: center;
        padding: 2rem;

        img {
          @media (prefers-color-scheme: dark) {
            filter: invert(1);
          }
        }
      }

      #trips {
        display: flex;
        flex-flow: column nowrap;
        max-width: 90ch;
        margin-inline: auto;

        trip-entry:hover,
        trip-entry[open] {
          background-color: var(--hover-bg-color);
          box-shadow: none;
        }

        trip-entry {
          --theme-color: var(--accent-color);

          &::part(button) {
            display: inline-block;
            background-color: transparent;
            color: currentColor;
            border: solid 1px currentColor;
            border-radius: 2px;
            text-align: center;
            text-decoration: none;
            margin: 1rem 2px;
            cursor: pointer;
            padding: 1rem 1.5rem;
            transition-duration: 0.4s;
          }
          &::part(button):hover {
            background-color: var(--hover-bg-color);
          }
        }
      }
    </style>
  </body>

  <script type="module">
    import { getSheetData } from "/get-trips.js";
    const tripsElement = document.getElementById("trips");
    const fetchedTrips = await getSheetData();
    const now = new Date();

    tripsElement.innerHTML = ""; /* Clear loading message */

    for (const trip of fetchedTrips) {
      if (!trip.reviewed) {
        console.info("Omitting unreviewed entry:", trip);
        continue;
      }

      if (new Date(trip.date_from) < now) {
        console.info("Omitting old entry:", trip);
        continue;
      }

      const tripElement = document.createElement("trip-entry");
      tripElement.data = trip;
      tripsElement.appendChild(tripElement);
    }
  </script>
</html>
